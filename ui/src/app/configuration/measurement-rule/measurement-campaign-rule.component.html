<div class="bgtrans">
  <div *ngIf="titleVisible" fxLayout="row" fxLayoutAlign="center center"
    style="padding: 10px; color: #fff; background: #5dc24e">
    <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="center center" style="width: 95%">
      {{ ruleCreatedMsg }}
    </div>
    <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="center center">
      <mat-icon (click)="onClose()" style="cursor: pointer">close</mat-icon>
    </div>
  </div>
  <div *ngIf="errorMsgVisible" fxLayout="row" fxLayoutAlign="center center"
    style="padding: 10px; color: #fff; background: red">
    <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="center center" style="width: 95%">
      {{ ruleCreatedMsg }}
    </div>
    <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="center center">
      <mat-icon (click)="onClose()" style="cursor: pointer">close</mat-icon>
    </div>
  </div>

  <mat-card class="mat-elevation-z" *ngIf="!createViewEditStatus">
    <div fxLayout="row" fxLayoutAlign="space-between" class="margin-bottom-sm">
      <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="left">
        <span class="font-18-px line-height-27px font-helvetica-md">Rule Details
          <mat-icon
            matTooltip="Rule are applied in the order shown in the below table. The order can be changed using the up-arrow or down-arrow."
            style="padding-left: 7px; font-size: 15px; padding-top: 4px; vertical-align: middle;">info</mat-icon>
        </span>
      </div>
    </div>
    <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm'>
      <div class='areaWidth' fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="left">
        <mat-form-field appearance="outline">
          <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Search">
          <span matPrefix>
            <mat-icon>search</mat-icon>
          </span>
        </mat-form-field>
      </div>
      <div fxLayout="row" class='areaWidth'>
        <div>
          <button  class='resetCancelBtnColor margin-right-10' mat-raised-button color="primary" (click)="ruleInterpreter()">Rule Interpreter
          </button>
          <button mat-flat-button color="primary" (click)="addNewRule()">
            <mat-icon>add_circle_outline</mat-icon>New Rule
          </button>
        </div>
      </div>
    </div>
    <div *ngIf='initData.length == 0'>{{ translationData.lblNoRecordFound  }}</div>
    <div *ngIf='initData.length > 0' fxLayout="row" class='margin-top-xlg' id="rulesData"
      [ngClass]="{'rulesTable': displayedColumns.length > 7}">
      <div fxLayout="column" class='full-width'>
        <mat-table matTableExporter [dataSource]="dataSource" class="table-items" matSort #exporter="matTableExporter"
          [hiddenColumns]="[5]">
          <ng-container matColumnDef="seqNumber">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Seq No</mat-header-cell>
            <mat-cell class="seqNum" *matCellDef="let row; let i = index;">{{ row.SeqNo }}
              <span class="swap">
                <button *ngIf="i != initData.length-1" class='actionBtn' mat-flat-button
                  matTooltip="click to move rule down" (click)="swapRow('down', i, initData)">
                  <mat-icon>keyboard_arrow_down</mat-icon>
                </button>
                <button *ngIf="i != 0" class='actionBtn' mat-flat-button matTooltip="click to move rule up"
                  (click)="swapRow('up', i, initData)">
                  <mat-icon>keyboard_arrow_up</mat-icon>
                </button>
              </span>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="startTime">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Start Date-Time</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.StartTimestampt }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="endTime">
            <mat-header-cell *matHeaderCellDef mat-sort-header>End Date-Time</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.EndTimestamp }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="status">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Status</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.Enabled }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="OEM">
            <mat-header-cell *matHeaderCellDef mat-sort-header>OEM</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.OEM }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="vehicleGeneration">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Vehicle Generation</mat-header-cell>
            <mat-cell *matCellDef="let row" matTooltip=""><span class="text-truncate"></span>{{ row.VehicleGeneration }}
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="tcuBrand">
            <mat-header-cell *matHeaderCellDef mat-sort-header>TCU's Brand</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.TCUBrand }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="connectState">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Connect State</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.ConnectedState }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="dataFrequency">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Data Frequency</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.Datafrequency }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="description">
            <mat-header-cell *matHeaderCellDef mat-sort-header>Description</mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.Description }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="action">
            <mat-header-cell *matHeaderCellDef class="action">Action</mat-header-cell>
            <mat-cell *matCellDef="let row" class="action">
              <button class='actionBtn' mat-flat-button matTooltip="View" (click)="onViewRule(row, 'view')">
                <mat-icon>visibility</mat-icon>
              </button>
              <button class='actionBtn' mat-flat-button matTooltip="Edit" (click)="onEditRule(row, 'edit')">
                <mat-icon>create</mat-icon>
              </button>
              <button class='actionBtn' mat-flat-button matTooltip="Duplicate"
                (click)="onDuplicateRule(row, 'duplicate')">
                <mat-icon>content_copy</mat-icon>
              </button>
              <button class='actionBtn' mat-flat-button matTooltip="Delete" (click)="onDelete(row)">
                <mat-icon class="deleteIcon">delete_outline</mat-icon>
              </button>
            </mat-cell>
          </ng-container>
          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;">
          </mat-row>
        </mat-table>
        <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
      </div>
    </div>
    <app-spinner *ngIf="showLoadingIndicator"></app-spinner>
  </mat-card>
  <div *ngIf="createViewEditStatus">
    <app-create-edit-view-rule [actionType]="actionType"
    [selectedRowData]="selectedElementData"
    [prefTimeZone]="prefTimeZone"
      [prefUnitFormat]="prefUnitFormat"
      [prefTimeFormat]="prefTimeFormat"
      [prefDateFormat]="prefDateFormat"
     (createViewEditRuleEmit)="checkCreationForRule($event)"></app-create-edit-view-rule>
  </div>
</div>
