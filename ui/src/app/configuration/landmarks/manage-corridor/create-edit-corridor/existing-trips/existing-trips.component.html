<form [formGroup]="existingTripForm">
  <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-xlg'>
    <div>
      <mat-label>{{ translationData.lblTimeRanges || 'Time Ranges' }} <span class='mandatoryColor'>*</span></mat-label>
      <div>
        <!-- <mat-form-field  class="full-width"> -->
        <button (click)="dateSelection('today')" class='resetCancelBtnColor margin-right-10' mat-raised-button color="primary">{{
          translationData.lblToday || 'Today' }}</button>
        <button (click)="dateSelection('yesterday')" class='resetCancelBtnColor margin-right-10' mat-raised-button color="primary">{{
          translationData.lblYesterday || 'Yesterday' }}</button>
        <button (click)="dateSelection('lastWeek')" class='resetCancelBtnColor margin-right-10' mat-raised-button color="primary">{{
          translationData.lblLastWeek || 'Last Week' }}</button>
        <button (click)="dateSelection('lastMonth')" class='resetCancelBtnColor margin-right-10' mat-raised-button color="primary">{{
          translationData.lblLastMonth || 'Last Month' }}</button>
        <button (click)="dateSelection('last3Months')" class='resetCancelBtnColor margin-right-10' mat-raised-button color="primary">{{
          translationData.lblLast3Months || 'Last 3 Months' }}</button>
        <!-- </mat-form-field> -->

      </div>

    </div>

    <div style="width: 170px; margin-right: 30px;">
      <mat-label>{{ translationData.lblVehicleGroup || 'Vehicle Group' }} <span class='mandatoryColor'>*</span>
      </mat-label>
      <!-- <mat-form-field class="full-width"> -->
      <mat-select (selectionChange)="vehicleGroupSelection($event)"
        placeholder="{{ translationData.lblDefaultBase || 'Default Base' }}" formControlName="vehicleGroup" required>
        <mat-option *ngFor="let vehicleGroupData of vehicleGroupIdsSet" [value]="vehicleGroupData">
          {{ vehicleGroupData}}
        </mat-option>
      </mat-select>
      <!-- </mat-form-field> -->
      <mat-error *ngIf="existingTripForm.get('vehicleGroup').hasError('required')">
        {{ translationData.lblPleasechoosevehicleGroup || 'Please choose vehicle group' }}
      </mat-error>
    </div>
  </div>

  <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-xlg'>
    <div class="dateTimePicker" style="width:75%" fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm'>
      <div>
        <div>
          <mat-label>From<span class='mandatoryColor'>*</span></mat-label>
        </div>
        <mat-form-field appearance="fill" >
          <input matInput [matDatepicker]="picker" (dateChange)="selectedStartDate($event)" formControlName="startDate" [formControl]="startDate">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <!-- <div>{{selectedStartDateStamp}}</div> -->
        <!-- <div>{{ startDate.value }} </div> -->
      </div>
      <div fxLayout="row" fxLayoutAlign="space-between center" class="timepicker">
        <input [ngxTimepicker]="toggleTimepicker" formControlName="startTime" [disableClick]="true" readonly>
        <ngx-material-timepicker-toggle [for]="toggleTimepicker"></ngx-material-timepicker-toggle>
        <ngx-material-timepicker (timeChanged)="timeChanged($event)" #toggleTimepicker></ngx-material-timepicker>
        <!-- <div>{{ selectedStartTime }} </div> -->
      </div>
      <div>
        <div>
          <mat-label>To<span class='mandatoryColor'>*</span></mat-label>
        </div>
        <mat-form-field appearance="fill">
          <input matInput [matDatepicker]="endpicker" (dateChange)="selectedEndDate($event)" formControlName="endDate" [formControl]="endDate">
          <mat-datepicker-toggle matSuffix [for]="endpicker"></mat-datepicker-toggle>
          <mat-datepicker #endpicker></mat-datepicker>
        </mat-form-field>

        <!-- <div>{{selectedEndDateStamp}}</div> -->
        <!-- <div>{{ endDate.value }} </div> -->
      </div>
      <div fxLayout="row" fxLayoutAlign="space-between center" class="timepicker">
        <input [ngxTimepicker]="endtoggleTimepicker" formControlName="endTime" [disableClick]="true" readonly>
        <ngx-material-timepicker-toggle [for]="endtoggleTimepicker"></ngx-material-timepicker-toggle>
        <ngx-material-timepicker (timeChanged)="endtimeChanged($event)" #endtoggleTimepicker></ngx-material-timepicker>
        <!-- <div>{{ selectedEndTime }} </div> -->
      </div>
    </div>
    <div style="width:170px; margin-right:30px">
      <mat-label>{{ translationData.lblVehicle || 'Vehicle' }} <span class='mandatoryColor'>*</span>
      </mat-label>
      <!-- <mat-form-field class="full-width"> -->
      <mat-select (selectionChange)="vinSelection($event)" placeholder="{{ translationData.lblVehicle || 'Vehicle' }}"
        formControlName="vehicle" required>
        <mat-option *ngFor="let vinListData of vinList" [value]="vinListData">
          {{ vinListData }}
        </mat-option>
      </mat-select>
      <!-- </mat-form-field> -->
      <mat-error *ngIf="existingTripForm.get('vehicleGroup').hasError('required')">
        {{ translationData.lblPleasechoosevehicle || 'Please choose vehicle' }}
      </mat-error>
    </div>

  </div>
  <div fxLayout="row" fxLayoutAlign="end end" class="full-width areaWidth">
    <button class='resetCancelBtnColor margin-right-10' mat-flat-button  (click)="onReset()">
      {{translationData.lblReset || 'Reset'}}
    </button>
    <button class='margin-right-10' mat-flat-button color="primary" (click)="onSearch()">
      {{translationData.lblSearch || 'Search'}}
    </button>
  </div>





<mat-card class='mat-elevation-z'>
  <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm'>
    <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="left">
      <span style='font: 500 16px/32px Roboto, "Helvetica Neue", sans-serif;'>Existing Trip Details</span>
    </div>
    <!-- <div class="groupDetails margin-bottom-sm" fxLayout="row" fxLayoutAlign="space-between">
      <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="end">
        <div fxLayout="row" class='areaWidth'>
          <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="end">
            <button mat-flat-button color="primary" (click)="onNewCorridor()">
              <mat-icon>add_circle_outline</mat-icon> {{ translationData.lblNewCorridor || 'New Corridor'
            }}
          </button>
        </div>
      </div>
    </div>
  </div> -->
</div>
<div #map class='mapDiv' style="width: 100%; height: 450px; margin-bottom: 25px"></div>

<div fxLayout="row" fxLayoutAlign="space-between" class="full-width margin-bottom-sm">
  <div class="col-sm-4 areaWidth" fxLayout="column" fxLayoutAlign="left">
      <mat-label>
          <span>{{ translationData.lblCorridorLabel || 'Corridor Label' }}</span>
          <span *ngIf="actionType != 'view'" class='mandatoryColor'>*</span>
      </mat-label>
      <div *ngIf="actionType != 'view'">
          <mat-form-field appearance="outline" class="full-width corridorLineHt">
              <input maxlength="100" placeholder="{{ translationData.lblEnterLabel|| 'Enter Label' }}" matInput
                  formControlName="label" required>
          </mat-form-field>
          <mat-error
              *ngIf="existingTripForm.get('label').hasError('required') && existingTripForm.get('label').touched">
              {{translationData.lblPleaseEnterName || 'Please Enter Name' }}
          </mat-error>
          <mat-error
              *ngIf="!existingTripForm.get('label').hasError('required')  && existingTripForm.get('label').hasError('whitespace')">
              {{ translationData.lblNamecannotcontainonlywhitespace || 'Name cannot contain only whitespace'
              }}
          </mat-error>
          <mat-error *ngIf="existingTripForm.get('label').hasError('specialCharsNotAllowed')">
              {{ translationData.lblSpecialcharactersnotallowed || 'Special characters not allowed' }}
          </mat-error>
      </div>
      <div *ngIf="actionType === 'view'">
          <span style='font-weight: 500!important;'>{{corridorName}}</span>
      </div>
  </div>
  <div class="col-sm-4 areaWidth" fxLayout="column" fxLayoutAlign="left">
      <mat-label>
          <span>{{ translationData.lblStartAddress || 'Start Address' }}</span>
          <span *ngIf="actionType != 'view'" class='mandatoryColor'>*</span>

      </mat-label>
      <div  *ngIf="actionType != 'view'">
          <ng2-completer inputClass="form-control form-control-small" autocapitalize="off" autocomplete="off" autocorrect="off" 
          [datasource]="dataService" [minSearchLength]="0" (focus)="onStartFocus()"  [(ngModel)] = "searchStr" [ngModelOptions]="{standalone: true}"
          (selected)="onSelected($event)" [selectOnClick]="true"></ng2-completer>
          <!-- <mat-form-field appearance="outline" class='full-width'>
             <input maxlength="50" placeholder="{{ translationData.lblEnterAddress|| 'Search Place' }}"
                  matInput formControlName="startaddress" (keyup)="getSuggestion($event)" (focusout)="startAddressFocusOut()" required> 
              </mat-form-field>  -->

          <mat-error
              *ngIf="searchStrError">
              {{translationData.lblPleaseEnterName || 'Please Enter Start Address' }}
          </mat-error>
      </div>
      <div *ngIf="actionType == 'view'">
          <span style='font-weight: 500!important;'>{{searchStr}}</span>
      </div>
  </div>
  <div class="col-sm-4 areaWidth" fxLayout="column" fxLayoutAlign="left">
      <mat-label>
          <span>{{ translationData.lblEndAddress || 'End Address' }}</span>
          <span *ngIf="actionType != 'view'" class='mandatoryColor'>*</span>

      </mat-label>
      <div  *ngIf="actionType != 'view'">
          <ng2-completer inputClass="form-control form-control-small"  autocapitalize="off" autocomplete="off" autocorrect="off" 
          [datasource]="dataService" [minSearchLength]="0" (focus)="onEndFocus()"  [(ngModel)] = "searchEndStr" [ngModelOptions]="{standalone: true}"
          [minSearchLength]="0" (selected)="onEndSelected($event)" [selectOnClick]="true"></ng2-completer>
         
          <!-- <mat-form-field appearance="outline" class='full-width'>
              <input maxlength="50" placeholder="{{ translationData.lblEnterAddress|| 'Search Place' }}"
                  matInput formControlName="endaddress" (focusout)="endAddressFocusOut()" required>
          </mat-form-field> -->
          <mat-error
              *ngIf="searchEndStrError">
              {{translationData.lblPleaseEnterName || 'Please Enter End Address' }}
          </mat-error>
      </div>
      <div *ngIf="actionType == 'view'">
          <span style='font-weight: 500!important;'>{{searchEndStr}}</span>
      </div>
  </div>
</div>
<div class="col-sm-4 areaWidth">
  <span>{{ translationData.lblWidth|| 'Width' }} ({{ translationData.lblKm|| 'km' }}):
      <input type="number" min="0" max="10" *ngIf="actionType != 'view'" class="sliderInput" formControlName="widthInput"  (focusout)="changeSliderInput()">
  </span>
  <div *ngIf="actionType == 'view'">
      <span style='font-weight: 500!important;'>{{corridorWidthKm}}</span>
  </div>
  <div *ngIf="actionType != 'view'">
      <ngx-slider [(value)]="corridorWidth" [options]="options" (mousemove)="sliderChanged()"></ngx-slider>
      <!-- <ngx-slider [(value)]="value" [options]="options"></ngx-slider> -->
  <!-- <mat-label>{{min}}</mat-label>
      <mat-slider class='sliderStyle' [min]="0" [max]="1000000" [step]="1" (change)="sliderChanged($event)"
          thumbLabel [displayWith]="formatLabel"></mat-slider>
  <mat-label>{{max}}</mat-label> -->

  </div>
  
</div>


<div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm'>
    <div class='areaWidth' fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="left">
      <mat-form-field appearance="outline">
        <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Search ">
        <span matPrefix>
          <mat-icon>search</mat-icon>
        </span>
      </mat-form-field>
    </div>
  </div>

  


  <div *ngIf='initData.length == 0'>No Record Found</div>
  <div *ngIf='initData.length > 0'>
    <mat-table [dataSource]="dataSource" class="table-items" matSort>
      <ng-container matColumnDef="All">
        <mat-header-cell *matHeaderCellDef class="max-width-10-per">
          <mat-checkbox (change)='$event ? masterToggleForCorridor() : null'
            [checked]='selectedCorridors.hasValue() && isAllSelectedForCorridor()'
            [indeterminate]='selectedCorridors.hasValue() && !isAllSelectedForCorridor()'
            [aria-label]='checkboxLabelForCorridor()'
            matTooltip="{{ translationData.lblcheckboxViewTooltipmsg || 'Select to view all on map; press DELETE button to delete all entities' }}">
          </mat-checkbox>
          <span style="margin: 5px 0px 0px 5px;">{{ translationData.lblAll || 'All' }}</span>
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
          <!-- <span *ngIf="row.newTag" class='newTagIcon marginLeft-24'></span>
        <span *ngIf="row.newTag" class='newTxtCss'>{{ translationData.lblNew || 'New' }}</span>
        <span [ngClass]="{ 'marginLeft-14': row.newTag }"></span> -->
          <span *ngIf="row.newTag" class='newTagIcon marginLeft-24'></span>
          <span *ngIf="row.newTag" class='newTxtCss'>{{ translationData.lblNew || 'New' }}</span>
          <span [ngClass]="{ 'marginLeft-14': row.newTag }"></span>
          <mat-checkbox (click)='$event.stopPropagation()'
            (change)='$event ? selectedCorridors.toggle(row) : null; checkboxClicked($event, row)'
            [checked]='selectedCorridors.isSelected(row)' [aria-label]='checkboxLabelForCorridor(row)'
            matTooltip="{{ translationData.lblcheckboxViewTooltipmsg || 'Select to view on map; press DELETE button to delete selected entity' }}">
          </mat-checkbox>
        </mat-cell>
      </ng-container>
      
      <ng-container matColumnDef="DriverName">
        <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblDriverName || 'Driver Name' }}
        </mat-header-cell>
        <mat-cell *matCellDef="let row" class="max-width-8-per">{{ row.driverFirstName }}</mat-cell>
        <!-- <mat-cell *matCellDef="let row" class="max-width-8-per">sadasd</mat-cell> -->
      </ng-container>
      <ng-container matColumnDef="distance">
        <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblDistance || 'Distance(km)' }}
        </mat-header-cell>
        <mat-cell *matCellDef="let row" class="max-width-8-per">{{ row.distance }}</mat-cell>
        <!-- <mat-cell *matCellDef="let row" class="max-width-8-per">dfd</mat-cell> -->
      </ng-container>
      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblDate || 'Date' }}</mat-header-cell>
        <mat-cell *matCellDef="let row">Date WBD</mat-cell>
        <!-- <mat-cell *matCellDef="let row">sdsf</mat-cell> -->
      </ng-container>
      <ng-container matColumnDef="startPoint">
        <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblStartPoint || 'StartPoint' }}
        </mat-header-cell>
        <mat-cell *matCellDef="let row" class="max-width-8-per">{{ row.startAddress }}</mat-cell>
        <!-- <mat-cell *matCellDef="let row" class="max-width-8-per">dfdsfds</mat-cell> -->
      </ng-container>
      <ng-container matColumnDef="endPoint">
        <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblEndPoint || 'EndPoint' }}
        </mat-header-cell>
        <mat-cell *matCellDef="let row" class="max-width-8-per">{{ row.endAddress }}</mat-cell>
        <!-- <mat-cell *matCellDef="let row" class="max-width-8-per">dfdsfdsfd</mat-cell> -->
      </ng-container>
     
      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;">
      </mat-row>
    </mat-table>
    <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" (page)="pageSizeUpdated($event)"></mat-paginator>
  </div>

</mat-card>
</form>