<form [formGroup]="alertAdvancedFilterForm"> 
   <!-- Select Period -->
   <mat-card *ngIf="((alert_category_selected === 'L') && (alert_type_selected === 'N' ||  alert_type_selected == 'X'))
   || ((alert_category_selected === 'F') && (alert_type_selected === 'I' || alert_type_selected === 'A')) && actionType != 'view'"
  class='mat-elevation-z'>
      <div *ngIf="((alert_category_selected + alert_type_selected == 'LN') ||
      (alert_category_selected + alert_type_selected == 'LX') ||
      (alert_category_selected + alert_type_selected == 'FA') ||
      (alert_category_selected + alert_type_selected == 'FI'))" > 
      <app-period-selection-filter  #periodComponent
      [translationData] = 'translationData'
      [selectedRowData] = 'selectedRowData'
      [actionType]='actionType'></app-period-selection-filter>
    </div>
  </mat-card>
  
  <!-- distance option -->
  <mat-card  *ngIf="((alert_category_selected === 'F' && alert_type_selected === 'A') ||
  (alert_category_selected === 'L' && alert_type_selected === 'S'))&& actionType != 'view'"
   class='mat-elevation-z'>
    <mat-expansion-panel class="full-width" fxLayoutGap="10px">
      <mat-expansion-panel-header class="full-width">
        <mat-panel-title>
          <mat-checkbox (change)="onChangeDistance($event)" [checked]="isDistanceSelected">
            <span class='font-16-px line-height-24px font-helvetica-md'>{{
              translationData.lblDistance }}<span class='mandatoryColor'>*</span></span>
          </mat-checkbox>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div *ngIf="isDistanceSelected" fxLayout="row" class="full-width filter-direction">
        <div fxLayout="column" class="areaWidth">
          <mat-label>{{ translationData.lblDistanceLimit }}<span class='mandatoryColor'>*</span>
            <mat-form-field appearance="outline">
              <input matInput placeholder="{{ translationData.lbl00 }}" formControlName="distance">
            </mat-form-field>
            <mat-label>{{distanceUnit}}</mat-label>
          </mat-label>
        </div>
        <div fxLayout="column" class="areaWidth">
          <p style="color: darkgray;padding-top:4px;margin: 2px;line-height : 4px; padding-left:4px">
            {{translationData.lblEnterathresholdwhenalertshouldbe }}</p>
          <p style="color: darkgray; padding-top:4px; padding-left:4px">{{translationData.triggeredforthiscriteria }}</p>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-card> 

  <!-- No of occurences option -->
  <mat-card *ngIf="((alert_category_selected === 'L' && (alert_type_selected === 'N' || alert_type_selected === 'X'))
                || (alert_category_selected === 'F' && (alert_type_selected === 'I' || alert_type_selected === 'A'))) && actionType != 'view'"
   class='mat-elevation-z'>
    <mat-expansion-panel class="full-width" fxLayoutGap="10px">
      <mat-expansion-panel-header class="full-width">
        <mat-panel-title>
          <mat-checkbox (change)="onChangeOccurence($event)" [checked]="isOccurenceSelected">
            <span class='font-16-px line-height-24px font-helvetica-md'>{{
              translationData.lblNumberofoccurences }}<span
                class='mandatoryColor'>*</span></span>
          </mat-checkbox>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div *ngIf="isOccurenceSelected" fxLayout="row" class="full-width filter-direction">
        <div fxLayout="column" class="areaWidth">
          <mat-label>{{ translationData.lblOccurences }}<span class='mandatoryColor'>*</span>
            <mat-form-field appearance="outline">
              <input matInput placeholder="{{ translationData.lbl00 }}" formControlName="occurences">
            </mat-form-field>
          </mat-label>
        </div>
        <div fxLayout="column" class="areaWidth">
          <p style="color: darkgray;padding-top:4px;margin: 2px;line-height : 4px; padding-left:4px">
            {{translationData.lblEnterathresholdwhenalertshouldbe }}</p>
          <p style="color: darkgray; padding-top:4px; padding-left:4px">{{translationData.triggeredforthiscriteria}}</p>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-card>

  <!-- Duration option -->
  <mat-card *ngIf="((alert_category_selected === 'L' && (alert_type_selected === 'N' || alert_type_selected === 'X' || alert_type_selected ==='S'))
                  || (alert_category_selected === 'F' && alert_type_selected === 'A')) && actionType != 'view'" 
    class='mat-elevation-z'>
    <mat-expansion-panel class="full-width" fxLayoutGap="10px">
      <mat-expansion-panel-header class="full-width">
        <mat-panel-title>
          <mat-checkbox (change)="onChangeDuration($event)" [checked]="isDurationSelected">
            <span class='font-16-px line-height-24px font-helvetica-md'>{{
              translationData.lblDuration }}<span class='mandatoryColor'>*</span></span>
          </mat-checkbox>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div *ngIf="isDurationSelected" fxLayout="row" class="full-width filter-direction">
        <div fxLayout="column" class="areaWidth">
          <mat-label>{{ translationData.lblDurationLimit }}<span class='mandatoryColor'>*</span>
            <mat-form-field appearance="outline">
              <input matInput placeholder="{{ translationData.lbl00 }}" formControlName="duration">
            </mat-form-field>
            <mat-label>s</mat-label>
          </mat-label>
        </div>
        <div fxLayout="column" class="areaWidth">
          <p style="color: darkgray;padding-top:4px;margin: 2px;line-height : 4px; padding-left:4px">
            {{translationData.lblEnterathresholdwhenalertshouldbe }}</p>
          <p style="color: darkgray; padding-top:4px; padding-left:4px">{{translationData.triggeredforthiscriteria }}</p>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-card>

  <!-- POI condition option -->
  <mat-card *ngIf="((alert_category_selected === 'F' && 
  (alert_type_selected === 'I' || alert_type_selected === 'A' || alert_type_selected === 'L' || 
  alert_type_selected === 'T' || alert_type_selected === 'P')) ||
  (alert_category_selected === 'L' && alert_type_selected === 'S'))"
  class='mat-elevation-z'>
    <mat-expansion-panel class="full-width" fxLayoutGap="10px" [expanded]="actionType == 'view'">
      <mat-expansion-panel-header class="full-width">
        <mat-panel-title *ngIf="actionType != 'view'">
          <mat-checkbox (change)="onChangePOI($event)" [checked]="isPoiSelected">
            <span class='font-16-px line-height-24px font-helvetica-md'>{{
              translationData.lblPOICondition }}<span class='mandatoryColor'>*</span></span>
          </mat-checkbox>
        </mat-panel-title>
        <mat-panel-title *ngIf="actionType == 'view'">
            <span class='font-16-px line-height-24px font-helvetica-md'>{{
              translationData.lblLandmarkDetails }}<span class='mandatoryColor'>*</span></span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-radio-group *ngIf="isPoiSelected && actionType != 'view'" (change)='onRadioButtonChange($event)' formControlName="poiSite">
        <mat-radio-button style='margin-right: 20px;' [checked]="enteringFlag" value="E">
          {{ translationData.lblEnteringSite }}
        </mat-radio-button>
        <mat-radio-button style='margin-right: 20px;' [checked]="existingFlag" value="X">
          {{ translationData.lblExitingSite }}
        </mat-radio-button>
      </mat-radio-group>

      <!-- entering site -->

      <div class="areawidth" *ngIf="isPoiSelected && actionType != 'view'">
        <span>{{ translationData.lblWidth}} ({{ ( prefUnitFormat == 'dunit_Metric') ? (translationData.lblkm) : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmile) : (translationData.lblmile) }}):
          <input type="number" min="0" max="10" *ngIf="actionType != 'view'" class="sliderInput" formControlName="widthInput"
            (focusout)="changeSliderInput()">
          <span style="color:red;">{{translationData.lblWidthcannotbe0mtrs}}</span>
        </span>
        <div class="areawidth" fxLayout="row" fxLayoutAlign="left">
          <div class="col-sm-4  areawidth">
            <ngx-slider [(value)]="poiWidth" [options]="options" (mousemove)="sliderChanged()"></ngx-slider>
          </div>
          <mat-label>{{translationData.lblmtr || 'mtr'}}</mat-label>
        </div>
      </div>

      <!-- Map -->

        <div [hidden]="!isPoiSelected" #map id="map" class="alert-filter-map" style="width: 100%; height: 450px; margin-bottom: 25px">
        </div>
        <div *ngIf="isPoiSelected">
        <!-- POI table -->
        <div>
          <div style='padding: 20px; position: relative;'>
            <mat-divider></mat-divider>
          </div>
          <mat-expansion-panel class="full-width" fxLayoutGap="10px" [expanded]="true">
            <mat-expansion-panel-header class="full-width">
              <mat-panel-title>
                <span><span
                    class='font-16-px line-height-24px font-helvetica-md'>{{(translationData.lblSelectPOI) }}</span> <span class='mandatoryColor'>*</span></span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div fxLayout="row" fxLayoutAlign="left" class='margin-bottom-sm'>
              <div style='margin-right: 50px;' class='areaWidth' fxLayout="column" fxLayoutGap="3px"
                fxLayoutAlign="left">
                <mat-form-field appearance="outline">
                  <input matInput (keyup)="applyFilterForPOI($event.target.value)"
                    placeholder="{{ translationData.lblSearch}}" formControlName="searchPOIData">
                  <span matPrefix>
                    <mat-icon>search</mat-icon>
                  </span>
                </mat-form-field>
              </div>
            </div>
            <div>
              <mat-table [dataSource]="poiDataSource" class="table-items" matSort>
                <ng-container matColumnDef="select">
                  <mat-header-cell *matHeaderCellDef>
                    <mat-checkbox (change)='$event ? masterToggleForPOI() : null'
                      [checked]='selectedPOI.hasValue() && isAllSelectedForPOI()'
                      [indeterminate]='selectedPOI.hasValue() && !isAllSelectedForPOI()'
                      [aria-label]='checkboxLabelForPOI()'>
                    </mat-checkbox>
                    <span style="margin: 5px 0px 0px 5px;">{{ translationData.lblAll}}</span>
                  </mat-header-cell>
                  <mat-cell *matCellDef="let row">
                    <mat-checkbox (click)='$event.stopPropagation()'
                      (change)='$event ? selectedPOI.toggle(row) : null; PoiCheckboxClicked($event,row)'
                      [checked]='selectedPOI.isSelected(row)' [aria-label]='checkboxLabelForPOI(row)'>
                    </mat-checkbox>
                  </mat-cell>
                </ng-container>
                <ng-container matColumnDef="icon">
                  <mat-header-cell *matHeaderCellDef>{{translationData.lblicon || 'Icon'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">
                    <mat-icon *ngIf="row.icon && row.icon == ''">place</mat-icon>
                    <img *ngIf="row.icon && row.icon != ''" [src]='row.icon' alt='' width='20px' height='20px'>
                  </mat-cell>
                </ng-container>
                <ng-container matColumnDef="name">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblName || 'Name'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.name }}</mat-cell>
                </ng-container>
                <ng-container matColumnDef="categoryName">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblCategory || 'Category'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.categoryName }}</mat-cell>
                </ng-container>
                <ng-container matColumnDef="subCategoryName">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblSubCategory || 'Sub Category'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.subCategoryName }}</mat-cell>
                </ng-container>
                <ng-container matColumnDef="address">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblAddress || 'Address'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.address }}, {{ row.city }}, {{ row.country }}</mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="displayedColumnsPOI"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumnsPOI;">
                </mat-row>
              </mat-table>
              <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
            </div>
          </mat-expansion-panel>
        </div>

        <!-- Geofence table -->
        <div>
          <div style='padding: 20px; position: relative;'>
            <mat-divider></mat-divider>
          </div>
          <mat-expansion-panel class="full-width" fxLayoutGap="10px" [expanded]="true">
            <mat-expansion-panel-header class="full-width">
              <mat-panel-title>
                <span><span class='font-16-px line-height-24px font-helvetica-md'>{{ (actionType == 'view')
                    ?
                    (translationData.lblSelectedGeofence) : (translationData.lblSelectGeofence) }}</span> <span class='mandatoryColor'>*</span></span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div fxLayout="row" fxLayoutAlign="left" class='margin-bottom-sm'>
              <div style='margin-right: 50px;' class='areaWidth' fxLayout="column" fxLayoutGap="3px"
                fxLayoutAlign="left">
                <mat-form-field appearance="outline">
                  <input matInput (keyup)="applyFilterForGeofence($event.target.value)"
                    placeholder="{{ translationData.lblSearch}}">
                  <span matPrefix>
                    <mat-icon>search</mat-icon>
                  </span>
                </mat-form-field>
              </div>
            </div>
            <div>
              <mat-table [dataSource]="geofenceDataSource" class="table-items" matSort>
                <ng-container matColumnDef="select">
                  <mat-header-cell *matHeaderCellDef>
                    <mat-checkbox (change)='$event ? masterToggleForGeofence() : null'
                      [checked]='selectedGeofence.hasValue() && isAllSelectedForGeofence()'
                      [indeterminate]='selectedGeofence.hasValue() && !isAllSelectedForGeofence()'
                      [aria-label]='checkboxLabelForGeofence()'>
                    </mat-checkbox>
                    <span style="margin: 5px 0px 0px 5px;">{{ translationData.lblAll}}</span>
                  </mat-header-cell>
                  <mat-cell *matCellDef="let row">
                    <mat-checkbox (click)='$event.stopPropagation()'
                      (change)='$event ? selectedGeofence.toggle(row) : null; geofenceCheckboxClicked($event,row)'
                      [checked]='selectedGeofence.isSelected(row)' [aria-label]='checkboxLabelForGeofence(row)'>
                    </mat-checkbox>
                  </mat-cell>
                </ng-container>
                <ng-container matColumnDef="name">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblName || 'Name'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.name }}</mat-cell>
                </ng-container>
                <ng-container matColumnDef="categoryName">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblCategory || 'Category'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.categoryName }}</mat-cell>
                </ng-container>
                <ng-container matColumnDef="subCategoryName">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblSubCategory || 'Sub Category'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.subCategoryName }}</mat-cell>
                </ng-container>
                <ng-container matColumnDef="address">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{translationData.lblAddress || 'Address'}}</mat-header-cell>
                  <mat-cell *matCellDef="let row">{{ row.address }}, {{ row.city }}, {{ row.country }}</mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="displayedColumnsGeofence"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumnsGeofence;">
                </mat-row>
              </mat-table>
              <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
            </div>
          </mat-expansion-panel>
        </div>

        <!-- Group table -->
        <div>
          <div style='padding: 20px; position: relative;'>
            <mat-divider></mat-divider>
          </div>
          <mat-expansion-panel class="full-width" fxLayoutGap="10px" [expanded]="true">
            <mat-expansion-panel-header class="full-width">
              <mat-panel-title>
                <span><span class='font-16-px line-height-24px font-helvetica-md'>{{ (actionType == 'view')
                    ? (translationData.lblSelectedGroup) : (translationData.lblSelectGroup) }}</span> <span class='mandatoryColor'>*</span></span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div fxLayout="row" fxLayoutAlign="left" class='margin-bottom-sm'>
              <div style='margin-right: 50px;' class='areaWidth' fxLayout="column" fxLayoutGap="3px"
                fxLayoutAlign="left">
                <mat-form-field appearance="outline">
                  <input matInput (keyup)="applyFilterForGroup($event.target.value)"
                    placeholder="{{ translationData.lblSearch }}">
                  <span matPrefix>
                    <mat-icon>search</mat-icon>
                  </span>
                </mat-form-field>
              </div>
            </div>
            <div>
              <mat-table matTableExporter [dataSource]="groupDataSource" matSort>
                <ng-container matColumnDef="select">
                  <mat-header-cell *matHeaderCellDef>
                    <mat-checkbox (change)='$event ? masterToggleForGroup($event) : null;'
                      [checked]='selectedGroup.hasValue() && isAllSelectedForGroup()'
                      [indeterminate]='selectedGroup.hasValue() && !isAllSelectedForGroup()'
                      [aria-label]='checkboxLabelForGroup()'>
                    </mat-checkbox>
                    <span style="margin: 5px 0px 0px 5px;">{{ translationData.lblAll}}</span>
                  </mat-header-cell>
                  <mat-cell *matCellDef="let row">
                    <mat-checkbox (click)='$event.stopPropagation()'
                      (change)='$event ? selectedGroup.toggle(row) : null; onGroupSelect($event, row)'
                      [checked]='selectedGroup.isSelected(row)' [aria-label]='checkboxLabelForGroup(row)'>
                    </mat-checkbox>
                  </mat-cell>
                </ng-container>
                <ng-container matColumnDef="name">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblName}}
                  </mat-header-cell>
                  <mat-cell *matCellDef="let row">
                    <span>{{row.name}}</span>
                  </mat-cell>
                </ng-container>
                <ng-container matColumnDef="poiCount">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblPOI}}
                  </mat-header-cell>
                  <mat-cell *matCellDef="let row" matTooltip={{row.poiCount}}><span
                      [ngClass]="row.poiCount !=0 ? 'row-hover' : '' "
                      (click)="row.poiCount !=0 ? onPOIClick(row) : ''">{{row.poiCount}}</span></mat-cell>
                </ng-container>
                <ng-container matColumnDef="geofenceCount">
                  <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblGeofence}}
                  </mat-header-cell>
                  <mat-cell *matCellDef="let row" matTooltip={{row.geofenceCount}}><span
                      [ngClass]="row.geofenceCount !=0 ? 'row-hover' : '' "
                      (click)="row.geofenceCount !=0 ? onGeofenceClick(row) : ''">{{row.geofenceCount}}</span>
                  </mat-cell>
                </ng-container>
                <mat-header-row *matHeaderRowDef="displayedColumnsGroup"></mat-header-row>
                <mat-row *matRowDef="let row; columns: displayedColumnsGroup;">
                </mat-row>
              </mat-table>
              <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
            </div>
          </mat-expansion-panel>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-card>
</form>
    <mat-card *ngIf="actionType == 'view'" class='mat-elevation-z'>
  <div fxLayout="row" *ngIf="this.selectedRowData.alertUrgencyLevelRefs[0].periodType == 'C' && this.selectedRowData.alertUrgencyLevelRefs[0].alertTimingDetail.length > 0" fxLayoutAlign="space-between" class="full-width filter-direction margin-bottom-sm" fxLayoutGap="10px">
    <div class="areaWidth full-width" fxLayout="column" fxLayoutAlign="left">
        <app-period-selection-filter  #periodComponent
        [translationData] = 'translationData'
        [selectedRowData] = 'selectedRowData'
        [actionType]='actionType'></app-period-selection-filter>
      </div>
      
    </div>
      <div *ngIf="distanceVal.length > 0" fxLayout="row" fxLayoutAlign="space-between"
        class="full-width filter-direction margin-bottom-sm" fxLayoutGap="10px">
        <div class="areaWidth half-width" fxLayout="column" fxLayoutAlign="left">
          <mat-label>{{ translationData.lblDistancelimit}}</mat-label>
          <span style='font-weight: 500!important;'>{{ distanceVal[0][0].thresholdValue }}</span>
        </div>
      </div>
      <div *ngIf="durationVal.length > 0" fxLayout="row" fxLayoutAlign="space-between"
      class="full-width filter-direction margin-bottom-sm" fxLayoutGap="10px">
      <div class="areaWidth half-width" fxLayout="column" fxLayoutAlign="left">
        <mat-label>{{ translationData.lblDurationlimit}}</mat-label>
        <span style='font-weight: 500!important;'>{{ durationVal[0][0].thresholdValue }}</span>
      </div>
    </div>
    <div *ngIf="occurenceVal.length > 0 " fxLayout="row" fxLayoutAlign="space-between"
    class="full-width filter-direction margin-bottom-sm" fxLayoutGap="10px">
    <div class="areaWidth half-width" fxLayout="column" fxLayoutAlign="left">
      <mat-label>{{ translationData.lblOccurences}}</mat-label>
      <span style='font-weight: 500!important;'>{{ occurenceVal[0][0].thresholdValue }}</span>
    </div>
  </div>
</mat-card>