<div class="bgtrans">
    <form [formGroup]="tripForm">
      <mat-card class='mat-elevation-z no-padding margin-bottom-xlg'>
        <mat-expansion-panel [(expanded)]="searchExpandPanel" class="full-width" fxLayoutGap="10px">
          <mat-expansion-panel-header class="full-width">
            <mat-panel-title>
              <span>
                <span>{{ translationData.lblSearchReportParameters || 'Search Report Parameters' }}</span>
              </span>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div>
            <div fxLayout="row" fxLayoutAlign="space-between" class="full-width margin-bottom-xlg" fxLayoutGap="10px">
              <div class="areaWidth min-width-60-per" fxLayout="column" fxLayoutAlign="left">
                <mat-label class='font-16-px line-height-24px'>{{ translationData.lblTimeRange || 'Time Range' }} <span class='mandatoryColor'>*</span></mat-label>
                <div style='margin-top: 5px;'>
                  <button [disabled]="selectionTab == 'today'" (click)="selectionTimeRange('today')" [ngClass]="{'selectedBtn': selectionTab == 'today'}" class='margin-right-10 no-margin margin-bottom-sm' mat-raised-button color="primary">{{translationData.lblToday || 'Today' }}</button>
                  <button [disabled]="selectionTab == 'yesterday'" (click)="selectionTimeRange('yesterday')" [ngClass]="{'selectedBtn': selectionTab == 'yesterday'}" class='margin-right-10 no-margin margin-bottom-sm' mat-raised-button color="primary">{{translationData.lblYesterday || 'Yesterday' }}</button>
                  <button [disabled]="selectionTab == 'lastweek'" (click)="selectionTimeRange('lastweek')" [ngClass]="{'selectedBtn': selectionTab == 'lastweek'}" class='margin-right-10 no-margin margin-bottom-sm' mat-raised-button color="primary">{{translationData.lblLastWeek || 'Last Week' }}</button>
                  <button [disabled]="selectionTab == 'lastmonth'" (click)="selectionTimeRange('lastmonth')" [ngClass]="{'selectedBtn': selectionTab == 'lastmonth'}" class='margin-right-10 no-margin margin-bottom-sm' mat-raised-button color="primary">{{translationData.lblLastMonth|| 'Last Month' }}</button>
                  <button [disabled]="selectionTab == 'last3month'" (click)="selectionTimeRange('last3month')" [ngClass]="{'selectedBtn': selectionTab == 'last3month'}" class='no-margin margin-bottom-sm' mat-raised-button color="primary">{{translationData.lblLast3Months || 'Last 3 Months' }}</button>
                </div>
              </div>
              <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                <!-- <mat-label>{{ translationData.lblVehicleGroup || 'Vehicle Group' }} <span class='mandatoryColor'>*</span></mat-label> -->
                <mat-label class='font-16-px line-height-24px'>{{ translationData.lblVehicleGroup || 'Vehicle Group' }} </mat-label>
                <mat-form-field appearance="outline">
                  <mat-select [disabled]="vehicleGrpDD.length == 0" (selectionChange)="onVehicleGroupChange($event, true)" placeholder="{{ translationData.lblSelectVehicleGroup || 'Select Vehicle Group' }}"  formControlName="vehicleGroup">
                      <mat-option>
                          <ngx-mat-select-search (keyup)="filterVehicleGroups(vehicleSearch.value)" placeholderLabel="{{ translationData.lblSearch|| 'Search' }}" #vehicleSearch>
                            <mat-icon (click)="resetVehicleGroupFilter()" ngxMatSelectSearchClear>close</mat-icon>
                          </ngx-mat-select-search>
                        </mat-option>
                    <mat-option *ngFor="let rer of filteredVehicleGroups | async " [value]="rer.vehicleGroupId">
                        {{ rer.vehicleGroupName }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-error *ngIf="tripForm.get('vehicleGroup').hasError('required') && vehicleGrpDD.length > 0">
                  {{translationData.lblPleaseSelectvehicleGroup || 'Please Select Vehicle Group' }}
                </mat-error>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="space-between" class="full-width margin-bottom-xlg" fxLayoutGap="10px">
              <div class="areaWidth min-width-60-per" fxLayout="column" fxLayoutAlign="left">
                <div fxLayout="row" fxLayoutAlign="space-between" class="full-width" fxLayoutGap="10px">
                  <div class="areaWidth min-width-40-per" fxLayout="column" fxLayoutAlign="left">
                    <mat-label class='font-16-px line-height-24px'>{{ translationData.lblFrom || 'From' }} <span class='mandatoryColor'>*</span></mat-label>
                    <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px">
                      <div class="areaWidth max-width-50-per" fxLayout="column" fxLayoutAlign="left">
                        <mat-form-field appearance="outline">
                          <input matInput [(ngModel)]="startDateValue" (dateChange)="changeStartDateEvent($event)" [min]='last3MonthDate' [max]='endDateValue' [matDatepicker]="startPicker" formControlName="startDate">
                          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                          <mat-datepicker #startPicker></mat-datepicker>
                        </mat-form-field>
                      </div>
                      <div class="areaWidth" fxLayout="column" fxLayoutAlign="left">
                        <div fxLayout="row" fxLayoutAlign="space-between" class="full-width" class="timepicker" style='margin-top: 4px;'>
                          <span class='timeAdjustSpan'>{{ startTimeDisplay }}</span>
                          <input [max]='maxStartTime' [(ngModel)]="selectedStartTime" class='inputBox' [format]="prefTimeFormat" [ngxTimepicker]="toggleStartTimepicker" [disableClick]="true" formControlName="startTime" readonly>
                          <ngx-material-timepicker-toggle [for]="toggleStartTimepicker"></ngx-material-timepicker-toggle>
                          <ngx-material-timepicker (timeChanged)="getStartTimeChanged($event)" #toggleStartTimepicker [cancelBtnTmpl]="cancelBtn" [confirmBtnTmpl]="confirmBtn"></ngx-material-timepicker>
                          <ng-template #cancelBtn> <button class="timepicker-button">Cancel</button> </ng-template> 
                          <ng-template #confirmBtn > <button class="timepicker-button" (click)="startTimeChanged($event)">Ok</button> </ng-template>  
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="areaWidth min-width-40-per" fxLayout="column" fxLayoutAlign="left">
                    <mat-label class='font-16-px line-height-24px'>{{ translationData.lblTo || 'To' }} <span class='mandatoryColor'>*</span></mat-label>
                    <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px">
                      <div class="areaWidth max-width-50-per" fxLayout="column" fxLayoutAlign="left">
                        <mat-form-field appearance="outline">
                          <input matInput [(ngModel)]="endDateValue" (dateChange)="changeEndDateEvent($event)" [min]='startDateValue' [max]='todayDate' [matDatepicker]="endPicker" formControlName="endDate">
                          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                          <mat-datepicker #endPicker></mat-datepicker>
                        </mat-form-field>
                      </div>
                      <div class="areaWidth" fxLayout="column" fxLayoutAlign="left">
                        <div fxLayout="row" fxLayoutAlign="space-between" class="full-width" class="timepicker" style='margin-top: 4px;'>
                          <span class='timeAdjustSpan'>{{ endTimeDisplay }}</span>
                         <input [min]='endTimeStart' [(ngModel)]="selectedEndTime"  class='inputBox' [format]="prefTimeFormat" [ngxTimepicker]="toggleEndTimepicker" [disableClick]="true" formControlName="endTime" readonly>
                          <ngx-material-timepicker-toggle [for]="toggleEndTimepicker"></ngx-material-timepicker-toggle>
                         <ngx-material-timepicker (timeChanged)="getEndTimeChanged($event)" #toggleEndTimepicker [cancelBtnTmpl]="cancelBtn2" [confirmBtnTmpl]="confirmBtn2"></ngx-material-timepicker>
                         <ng-template #cancelBtn2> <button class="timepicker-button">Cancel</button> </ng-template> 
                         <ng-template #confirmBtn2 > <button class="timepicker-button" (click)="endTimeChanged($event)">Ok</button> </ng-template>  
                       </div>
                     </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                <!-- <mat-label>{{ translationData.lblVehicle || 'Vehicle' }} <span class='mandatoryColor'>*</span></mat-label> -->
                <mat-label class='font-16-px line-height-24px'>{{ translationData.lblVehicle || 'Vehicle' }}</mat-label>
                <mat-form-field appearance="outline">
                  <mat-select [disabled]="vehicleDD.length == 0" (selectionChange)="onVehicleChange($event)" placeholder="{{ translationData.lblSelectVehicle || 'Select Vehicle' }}" formControlName="vehicle">
                    <!-- <mat-option value="0">All</mat-option> -->
                    <mat-option>
                        <ngx-mat-select-search (keyup)="filterVehicle(VehicleSearch.value)" placeholderLabel="{{ translationData.lblSearch|| 'Search' }}" #VehicleSearch>
                          <mat-icon (click)="resetVehicleFilter()" ngxMatSelectSearchClear>close</mat-icon>
                        </ngx-mat-select-search>
                      </mat-option>
                      <mat-option *ngFor="let rer of filteredVehicle | async" [value]="rer.vehicleId">
                          <span *ngIf="rer.vehicleId==0"> {{rer.vehicleName}} </span>
                      <span *ngIf="vehicleDisplayPreference == 'dvehicledisplay_VehicleName' && rer.vehicleId !==0"> {{rer.vehicleName}} </span>
                      <span *ngIf="vehicleDisplayPreference == 'dvehicledisplay_VehicleIdentificationNumber' && rer.vehicleId !==0"> {{rer.vin}} </span>
                      <span *ngIf="vehicleDisplayPreference == 'dvehicledisplay_VehicleRegistrationNumber' && rer.vehicleId !==0"> {{rer.registrationNo ? rer.registrationNo : rer.vehicleName}} </span>
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <mat-error *ngIf="tripForm.get('vehicle').hasError('required') && vehicleDD.length > 0">
                  {{translationData.lblPleaseSelectVehicle || 'Please Select Vehicle' }}
                </mat-error>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="end" class='areaWidth'>
              <button class='resetCancelBtnColor margin-right-10 no-margin' mat-raised-button color="primary"
                (click)='onReset()'>{{translationData.lblReset || 'Reset' }}</button>
              <button [disabled]="!tripForm.valid" class='no-margin' mat-raised-button color="primary"
                (click)='onSearch()'>{{ translationData.lblSearch || 'Search' }}</button>
            </div>
          </div>
        </mat-expansion-panel>
      </mat-card>
    </form>
    <!-- Summary Section -->
    <div id ="charts">
    <mat-card *ngIf='initData.length > 0' class='mat-elevation-z no-padding margin-bottom-xlg' id ="summary">
        <mat-expansion-panel [(expanded)]="isSummaryOpen" class="full-width" fxLayoutGap="10px" (opened)="isSummaryOpen == true"
        (closed)="isSummaryOpen == false">
          <mat-expansion-panel-header class="full-width">
            <mat-panel-title>
              <span>{{ translationData.lblSummary || 'Summary' }}</span>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div *ngIf='initData.length > 0'>
            <div style='padding: 30px 20px; margin-bottom: 10px; background: #bee3f8;'>
              <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">
                <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                  <span>
                    <span>{{ translationData.lblFrom || 'From' }}: </span>
                    <span class='font-helvetica-md'>{{ tableInfoObj.fromDate }}</span>
                  </span>
                </div>
                <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                  <span>
                    <span>{{ translationData.lblVehicleGroup || 'Vehicle Group' }}: </span>
                    <span class='font-helvetica-md'>{{ tableInfoObj.vehGroupName }}</span>
                  </span>
                </div>
                <div *ngIf='!showField.vin' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                  <span>
                    <span>{{ translationData.lblTo || 'To' }}: </span>
                    <span class='font-helvetica-md'>{{ tableInfoObj.endDate }}</span>
                  </span>
                </div>
              </div>
              <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">
                <div *ngIf='showField.vin' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                  <span>
                    <span>{{ translationData.lblTo || 'To' }}: </span>
                    <span class='font-helvetica-md'>{{ tableInfoObj.endDate }}</span>
                  </span>
                </div>
                <div *ngIf='showField.vehicleName' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                  <span>
                    <span>{{ translationData.lblVehicleName || 'Vehicle Name' }}: </span>
                    <span class='font-helvetica-md'>{{ tableInfoObj.vehicleName }}</span>
                  </span>
                </div>
              </div>
            </div>
            <div fxLayout="row" fxLayoutAlign="center space-between " class="full-width" fxLayoutGap="10px">
              <div *ngIf='noOfVehStatus' class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                  <div>
                      <span>{{ translationData.lblNumberOfVehicles || 'Number of vehicles' }} </span>
                  </div>
                  <div>
                      <span class='font-helvetica-md'>{{sumOfColumns('NumberOfVehicles')}}</span>
                  </div>
              </div>
              <div *ngIf='totalDistanceStatus' class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                  <div>
                      <span>{{ translationData.lblTotalDistance || 'Total distance' }} </span>
                  </div>
                  <div>
                      <span class='font-helvetica-md'>{{sumOfColumns('distance').toFixed(2)}} {{( prefUnitFormat == 'dunit_Metric') ? (translationData.lblkm || 'km') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmile || 'mile') : (translationData.lblmile || 'mile')  }}</span>
                  </div>
              </div>
              <div *ngIf='noOfTripsStatus' class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                  <div>
                      <span>{{ translationData.lblNumberOfTrips || 'Number of trips' }} </span>
                  </div>
                  <div>
                      <span class='font-helvetica-md'>{{sumOfColumns('NumberOfTrips')}}</span>
                  </div>
              </div>
              <div *ngIf='avgDistanceStatus' class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                  <div>
                      <span>{{ translationData.lblAverageDistancePerDay || 'Average distance per day' }} </span>
                  </div>
                  <div>
                      <span class='font-helvetica-md'>{{sumOfColumns('AverageDistancePerDay').toFixed(2)}} {{( prefUnitFormat == 'dunit_Metric') ? (translationData.lblkmperday || 'km/day') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmilesperday || 'miles/day') : (translationData.lblmilesperday || 'miles/day')  }}</span>
                  </div>
              </div>
              <div *ngIf='idleDurationStatus' class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                  <div>
                      <span>{{ translationData.lblIdleDuration || 'Idle duration' }} </span>
                  </div>
                  <div>
                      <span class='font-helvetica-md'>{{idleDurationSumConverted}} {{translationData.lblhhmm}}</span>
                  </div>
              </div>
            </div>

          </div>
        </mat-expansion-panel>
    </mat-card>
<!-- Charts view -->
      <mat-card *ngIf='initData.length > 0' class='mat-elevation-z no-padding margin-bottom-xlg'>
        <mat-expansion-panel [(expanded)]="isChartsOpen" class="full-width" fxLayoutGap="10px" (opened)="isChartsOpen"
        (closed)="!isChartsOpen">
          <mat-expansion-panel-header class="full-width">
            <mat-panel-title>
              <span>{{ translationData.lblCharts || 'Charts' }}</span>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px" style='margin-top: 10px;'>
          <div *ngIf='distanceChart && distanceChart.state' class="areaWidth areaWidth half-width" fxLayout="column" fxLayoutAlign="left"  style="padding: 10px;border: 1px solid #ddd;">
            <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblDistancePerDay || 'Distance per day' }}</span>
            <div class="chart-wrapper">            
            <highcharts-chart
            [Highcharts] = "highcharts" 
            [options] = "chartOptions1"             
            style = "width:100%;height:300px;display: block;">
           </highcharts-chart>
           <div class="hidelbleblank"></div>
          </div>
        </div>
        <div *ngIf='activeVehicleChart && activeVehicleChart.state' class="areaWidth half-width" fxLayout="column" fxLayoutAlign="right"  style="padding:10px 20px;border: 1px solid #ddd;">
          <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblActiveVehiclesPerDay || 'Active vehicles per day' }}</span>
          <div class="chart-wrapper">
          <highcharts-chart
          [Highcharts] = "highcharts" 
          [options] = "chartOptions"             
          style = "width:100%;height:300px;display: block;">
        </highcharts-chart>
        <div class="hidelbleblank"></div>
      </div>
      </div>
     </div>
      <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px" style='margin-top: 10px;'>
        <div *ngIf='mileageBasedChart && mileageBasedChart.state' class="areaWidth half-width" fxLayout="column" fxLayoutAlign="left"  style="padding: 10px;border: 1px solid #ddd;">
          <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblMileageBasedUtilisation || 'Mileage based utilisation' }}</span>
          <div *ngIf = "mileageDChartType" class="chart-wrapper">
            <canvas baseChart
            [data]="doughnutChartData"
            [chartType]="doughnutChartType"
            [labels]="doughnutChartLabels"
            [colors]="doughnutChartColors"
            [options]="doughnut_barOptions"
            [legend]="barChartLegend">
          </canvas>
        </div>
        <div *ngIf = "!mileageDChartType" class="chart-wrapper">
          <canvas baseChart
          [data]="mileagePieChartData"
          [labels]="mileagePieChartLabels"
          [chartType]="pieChartType"
          [options]="pieChartOptions"
          [colors]="doughnutChartColors"
          [plugins]="pieChartPlugins"
          [legend]="barChartLegend">
        </canvas>
      </div>
        </div>
        <div *ngIf='timeBasedChart && timeBasedChart.state' class="areaWidth half-width" fxLayout="column" fxLayoutAlign="right" style="padding: 10px;border: 1px solid #ddd;">
          <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblTimeBasedUtilisation || 'Time based utilisation' }}</span>
          <div *ngIf = "timeDChartType" class="chart-wrapper">
            <canvas baseChart
            [data]="doughnutChartDataForTime"
            [chartType]="doughnutChartTypeTime"
            [labels]="doughnutChartLabelsForTime"
            [colors]="doughnutChartColors"
            [options]="doughnut_barOptions"
            [legend]="barChartLegend">
          </canvas>
        </div>
        <div *ngIf = "!timeDChartType" class="chart-wrapper">
          <canvas baseChart
          [data]="timePieChartData"
          [labels]="timePieChartLabels"
          [chartType]="pieChartType"
          [colors]="doughnutChartColors"
          [options]="pieChartOptions"
          [plugins]="pieChartPlugins"
          [legend]="barChartLegend">
        </canvas>
      </div>
        </div>
      </div>
      </mat-expansion-panel>
      </mat-card>
      <!-- Calendar view -->
      <mat-card *ngIf='initData.length > 0 && calenderCardView'  class='mat-elevation-z no-padding margin-bottom-xlg'>
        <mat-expansion-panel [(expanded)]="isCalendarOpen" class="full-width" fxLayoutGap="10px" (opened)="isCalendarOpen == true"
        (closed)="isCalendarOpen == false">
          <mat-expansion-panel-header class="full-width">
            <mat-panel-title>
              <span>{{ translationData.lblCalendar || 'Calendar' }}</span>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">
            <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
              <span>
                <span>{{ translationData.lblFrom || 'From' }}: </span>
                <span class='font-helvetica-md'>{{ tableInfoObj.fromDate }}</span>
              </span>
            </div>
            <div *ngIf='showField.vin' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
              <span>
                <span>{{ translationData.lblTo || 'To' }}: </span>
                <span class='font-helvetica-md'>{{ tableInfoObj.endDate }}</span>
              </span>
            </div>
            </div>
          <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px">
            <div class="areaWidth half-width" fxLayout="column" fxLayoutAlign="left">
              <full-calendar [options]="calendarOptions"></full-calendar>
            </div>
          </div>
      </mat-expansion-panel>
      </mat-card>
    </div>

    <!--------------------------------------For export pdf section------------------>
    <div id ="hideData">
      <div *ngIf="dontShow">
      <mat-card *ngIf='initData.length > 0' class='mat-elevation-z no-padding margin-bottom-xlg' id ="summary">
          <mat-expansion-panel [(expanded)]="isSummaryOpen" class="full-width" fxLayoutGap="10px" (opened)="isSummaryOpen == true"
          (closed)="isSummaryOpen == false">
            <mat-expansion-panel-header class="full-width">
              <mat-panel-title>
                <span>{{ translationData.lblSummary || 'Summary' }}</span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div *ngIf='initData.length > 0'>
              <div style='padding: 30px 20px; margin-bottom: 10px; background: #bee3f8;'>
                <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">
                  <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                    <span>
                      <span>{{ translationData.lblFrom || 'From' }}: </span>
                      <span class='font-helvetica-md'>{{ tableInfoObj.fromDate }}</span>
                    </span>
                  </div>
                  <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                    <span>
                      <span>{{ translationData.lblVehicleGroup || 'Vehicle Group' }}: </span>
                      <span class='font-helvetica-md'>{{ tableInfoObj.vehGroupName }}</span>
                    </span>
                  </div>
                  <div *ngIf='!showField.vin' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                    <span>
                      <span>{{ translationData.lblTo || 'To' }}: </span>
                      <span class='font-helvetica-md'>{{ tableInfoObj.endDate }}</span>
                    </span>
                  </div>
                </div>
                <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">
                  <div *ngIf='showField.vin' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                    <span>
                      <span>{{ translationData.lblTo || 'To' }}: </span>
                      <span class='font-helvetica-md'>{{ tableInfoObj.endDate }}</span>
                    </span>
                  </div>
                  <div *ngIf='showField.vehicleName' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                    <span>
                      <span>{{ translationData.lblVehicleName || 'Vehicle Name' }}: </span>
                      <span class='font-helvetica-md'>{{ tableInfoObj.vehicleName }}</span>
                    </span>
                  </div>
                </div>
              </div>
              <div fxLayout="row" fxLayoutAlign="center space-between " class="full-width" fxLayoutGap="10px">
                <div class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                    <div>
                        <span>{{ translationData.lblNumberOfVehicles || 'Number of vehicles' }} </span>
                    </div>
                    <div>
                        <span class='font-helvetica-md'>{{sumOfColumns('NumberOfVehicles')}}</span>
                    </div>
                </div>
                <div class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                    <div>
                        <span>{{ translationData.lblTotalDistance || 'Total distance' }} </span>
                    </div>
                    <div>
                        <span class='font-helvetica-md'>{{sumOfColumns('distance').toFixed(2)}} {{( prefUnitFormat == 'dunit_Metric') ? (translationData.lblkm || 'km') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmile || 'mile') : (translationData.lblmile || 'mile')  }}</span>
                    </div>
                </div>
                <div class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                    <div>
                        <span>{{ translationData.lblNumberOfTrips || 'Number of trips' }} </span>
                    </div>
                    <div>
                        <span class='font-helvetica-md'>{{sumOfColumns('NumberOfTrips')}}</span>
                    </div>
                </div>
                <div class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                    <div>
                        <span>{{ translationData.lblAverageDistancePerDay || 'Average distance per day' }} </span>
                    </div>
                    <div>
                        <span class='font-helvetica-md'>{{sumOfColumns('AverageDistancePerDay').toFixed(2)}} {{( prefUnitFormat == 'dunit_Metric') ? (translationData.lblkmperday || 'km/day') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmilesperday || 'miles/day') : (translationData.lblmilesperday || 'miles/day')  }}</span>
                    </div>
                </div>
                <div class="areaWidth min-width-19-per padding-20px summary-bg-color" fxLayout="column" fxLayoutAlign="center center">
                    <div>
                        <span>{{ translationData.lblIdleDuration || 'Idle duration' }} </span>
                    </div>
                    <div>
                        <span class='font-helvetica-md'>{{idleDurationSumConverted}} {{translationData.lblhhmm}}</span>
                    </div>
                </div>
              </div>
            </div>
          </mat-expansion-panel>
      </mat-card>
      <mat-card *ngIf='initData.length > 0' class='mat-elevation-z no-padding margin-bottom-xlg'>
          <mat-expansion-panel [(expanded)]="isChartsOpen" class="full-width" fxLayoutGap="10px" (opened)="isChartsOpen"
          (closed)="!isChartsOpen">
            <mat-expansion-panel-header class="full-width">
              <mat-panel-title>
                <span>{{ translationData.lblCharts || 'Charts' }}</span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px" style='margin-top: 10px;'>
            <div class="areaWidth areaWidth half-width" fxLayout="column" fxLayoutAlign="left"  style="padding: 10px;border: 1px solid #ddd;">
              <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblDistancePerDay || 'Distance per day' }}</span>
              <div class="chart-wrapper">
              <highcharts-chart
              [Highcharts] = "highcharts"
              [options] = "chartOptions1"
              style = "width:100%;height:300px;display: block;">
             </highcharts-chart>
             <div class="hidelbleblank"></div>
            </div>
          </div>
          <div class="areaWidth half-width" fxLayout="column" fxLayoutAlign="right"  style="padding:10px 20px;border: 1px solid #ddd;">
            <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblActiveVehiclesPerDay || 'Active vehicles per day' }}</span>
            <div class="chart-wrapper">
            <highcharts-chart
            [Highcharts] = "highcharts"
            [options] = "chartOptions"
            style = "width:100%;height:300px;display: block;">
          </highcharts-chart>
          <div class="hidelbleblank"></div>
        </div>
        </div>
       </div>
        <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px" style='margin-top: 10px;'>
          <div class="areaWidth half-width" fxLayout="column" fxLayoutAlign="left"  style="padding: 10px;border: 1px solid #ddd;">
            <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblMileageBasedUtilisation || 'Mileage based utilisation' }}</span>
            <div *ngIf="mileageDChartType" class="chart-wrapper">
              <canvas baseChart
              [data]="doughnutChartData"
              [chartType]="doughnutChartType"
              [labels]="doughnutChartLabels"
              [colors]="doughnutChartColors"
              [options]="doughnut_barOptions"
              [legend]="barChartLegend">
            </canvas>
          </div>
          <div *ngIf="!mileageDChartType" class="chart-wrapper">
            <canvas baseChart
            [data]="mileagePieChartData"
            [labels]="mileagePieChartLabels"
            [chartType]="pieChartType"
            [options]="pieChartOptions"
            [colors]="doughnutChartColors"
            [plugins]="pieChartPlugins"
            [legend]="barChartLegend">
          </canvas>
        </div>
          </div>
          <div *ngIf='timeBasedChart && timeBasedChart.state' class="areaWidth half-width" fxLayout="column" fxLayoutAlign="right" style="padding: 10px;border: 1px solid #ddd;">
            <span style='text-align: center; margin-bottom: 10px;' class='font-16-px line-height-24px font-helvetica-md'>{{ translationData.lblTimeBasedUtilisation || 'Time based utilisation' }}</span>
            <div *ngIf="timeDChartType" class="chart-wrapper">
              <canvas baseChart
              [data]="doughnutChartDataForTime"
              [chartType]="doughnutChartTypeTime"
              [labels]="doughnutChartLabelsForTime"
              [colors]="doughnutChartColors"
              [options]="doughnut_barOptions"
              [legend]="barChartLegend">
            </canvas>
          </div>
          <div *ngIf="!timeDChartType" class="chart-wrapper">
            <canvas baseChart
            [data]="timePieChartData"
            [labels]="timePieChartLabels"
            [chartType]="pieChartType"
            [colors]="doughnutChartColors"
            [options]="pieChartOptions"
            [plugins]="pieChartPlugins"
            [legend]="barChartLegend">
          </canvas>
        </div>
          </div>
        </div>
        </mat-expansion-panel>
        </mat-card> 
        <mat-card *ngIf='initData.length > 0' class='mat-elevation-z no-padding margin-bottom-xlg'>
          <mat-expansion-panel [(expanded)]="isPDFCalendarOpen" class="full-width" fxLayoutGap="10px" (opened)="isPDFCalendarOpen == true"
          (closed)="isPDFCalendarOpen == false">
            <mat-expansion-panel-header class="full-width">
              <mat-panel-title>
                <span>{{ translationData.lblCalendar || 'Calendar' }}</span>
              </mat-panel-title>
            </mat-expansion-panel-header>
            <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">
              <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                <span>
                  <span>{{ translationData.lblFrom || 'From' }}: </span>
                  <span class='font-helvetica-md'>{{ tableInfoObj.fromDate }}</span>
                </span>
              </div>
              <div *ngIf='showField.vin' class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
                <span>
                  <span>{{ translationData.lblTo || 'To' }}: </span>
                  <span class='font-helvetica-md'>{{ tableInfoObj.endDate }}</span>
                </span>
              </div>
              </div>
            <div fxLayout="row" fxLayoutAlign="start" class="full-width" fxLayoutGap="10px">
              <div class="areaWidth half-width" fxLayout="column" fxLayoutAlign="left">
                <full-calendar [options]="calendarOptions"></full-calendar>
              </div>
            </div>
        </mat-expansion-panel>
        </mat-card>
    </div>
  </div>
    <!-- export PDF finish -->

      <!-- Fleet Table -->
      <mat-card class='mat-elevation-z no-padding margin-bottom-xlg'>
        <mat-expansion-panel [(expanded)]="tableExpandPanel" class="full-width" fxLayoutGap="10px">
          <mat-expansion-panel-header class="full-width">
            <mat-panel-title>
              <span>{{ translationData.lblAllDetails || 'All Details' }}</span>
            </mat-panel-title>
          </mat-expansion-panel-header>
          <div *ngIf='noRecordFound'>
            <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm'>{{ translationData.lblNoRecordFound || '' }}</div>
          </div>
          <div *ngIf='initData.length == 0 && !noRecordFound'>
            <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm'>{{ translationData.lblSelectionMessage || 'Please select and search required fields from top to view the details' }}</div>
          </div>
          <div *ngIf='initData.length > 0'  [ngClass]="{'reportTable': displayedColumns.length > 7}">
          <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm' fxLayoutGap="10px">
            <div class='areaWidth' fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="left">
              <mat-form-field appearance="outline">
                  <input matInput (keyup)="applyFilter($event.target.value)" placeholder="{{ translationData.lblSearch || 'Search' }}">
                  <span matPrefix><mat-icon>search</mat-icon></span>
              </mat-form-field>
            </div>
            <div class='areaWidth' fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="end">
              <button mat-button [matMenuTriggerFor]="menu">
                <mat-icon>file_upload</mat-icon>{{ translationData.lblExport || 'Export' }}<mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="exportAsExcelFile()">{{ translationData.lblExcel || 'Excel' }}</button>
                <button mat-menu-item (click)="exportAsPDFFile()">{{ translationData.lblPDF || 'PDF' }}</button>
              </mat-menu>
            </div>
          </div>
          <div id="fleetDetailBlock">
          <mat-table matTableExporter [dataSource]="dataSource" class="table-items"
          matSort #exporter="matTableExporter">
          <ng-container matColumnDef="vehicleName">
            <mat-header-cell [ngClass]="{'text-truncate': displayedColumns.length > 7}" *matHeaderCellDef mat-sort-header>{{ translationData.lblVehicleName || 'Vehicle Name' }}
            </mat-header-cell>
            <mat-cell [ngClass]="{'text-truncate': displayedColumns.length > 7}" matTooltip='{{ row.vehicleName }}' *matCellDef="let row">
              <span class='navigatePoint' (click)='gotoTrip(row)'>{{ row.vehicleName != '' ? row.vehicleName : '-' }}</span>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="vin">
            <mat-header-cell [ngClass]="{'text-truncate': displayedColumns.length > 6}" *matHeaderCellDef mat-sort-header>{{ translationData.lblVIN || 'VIN' }}
            </mat-header-cell>
            <mat-cell [ngClass]="{'text-truncate': displayedColumns.length > 6}" *matCellDef="let row">
              <span class='navigatePoint' matTooltip='{{ translationData.lbltooltipMsg || "Click to view details"}}' (click)='gotoTrip(row)'>{{ row.vin != '' ? row.vin : '-' }}</span>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="registrationNumber">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblRegistrationNumber || 'Registration Number' }}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">
              <span class='navigatePoint' matTooltip='{{ translationData.lbltooltipMsg || "Click to view details"}}' (click)='gotoTrip(row)'>{{ row.registrationNumber != '' ? row.registrationNumber : '-' }}</span>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="distance">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblDistance || 'Distance' }} <span class='font-14-px'>({{( prefUnitFormat == 'dunit_Metric') ? (translationData.lblkm || 'km') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmile || 'miles') : (translationData.lblmile || 'miles')  }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedDistance != '' ? row.convertedDistance : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="numberOfTrips">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblNumberOfTrips || 'Number Of Trips' }}
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.numberOfTrips != '' ? row.numberOfTrips : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="tripTime">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblTripTime || 'Trip Time' }} <span class='font-14-px'>({{ translationData.lblhhmm || 'hh:mm' }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedTripTime != '' ? row.convertedTripTime : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="drivingTime">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblDrivingTime || 'Driving Time' }} <span class='font-14-px'>({{ translationData.lblhhmm || 'hh:mm' }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedDrivingTime != '' ? row.convertedDrivingTime : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="idleDuration">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblIdleDuration || 'Idle Duration' }} <span class='font-14-px'>({{ translationData.lblhhmm || 'hh:mm' }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedIdleDuration != '' ? row.convertedIdleDuration : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="stopTime">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblStopTime || 'Stop time' }} <span class='font-14-px'>({{ translationData.lblhhmm || 'hh:mm' }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedStopTime != '' ? row.convertedStopTime : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="averageDistancePerDay">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblAverageDistanceperDay || 'Average Distance per Day' }} <span class='font-14-px'>({{( prefUnitFormat == 'dunit_Metric') ? (translationData.lblkmperday || 'km/day') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmilesperday || 'miles/day') : (translationData.lblmilesperday || 'miles/day')  }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedAverageDistance != '' ? row.convertedAverageDistance : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="averageSpeed">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblAverageSpeed || 'Average Speed' }} <span class='font-14-px'>({{ (prefUnitFormat == 'dunit_Metric') ? (translationData.lblkmh || 'km/h') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmph || 'mph') : (translationData.lblmph || 'mph')  }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedAverageSpeed != '' ? row.convertedAverageSpeed : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="averageWeight">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblAverageWeightperTrip || 'Average Weight per Trip' }} <span class='font-14-px'>({{ translationData.lblton || 'ton' }})</span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedAverageWeight != '' ? row.convertedAverageWeight : '-' }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="odometer">
            <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblOdometer || 'Odometer' }}
               <span class='font-14-px'>
                ({{(prefUnitFormat == 'dunit_Metric') ? (translationData.lblkm || 'km') : (prefUnitFormat == 'dunit_Imperial') ? (translationData.lblmile || 'miles') : (translationData.lblmile || 'miles')  }})
              </span>
            </mat-header-cell>
            <mat-cell *matCellDef="let row">{{ row.convertedOdometer != '' ? row.convertedOdometer : '-' }}</mat-cell>
          </ng-container>
          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;">
          </mat-row>
          </mat-table>
          <mat-paginator [pageSizeOptions]="[5, 10, 25, 100, 500]" (page)="pageSizeUpdated($event)"></mat-paginator>
          </div>
        </div>
          <app-spinner *ngIf="showLoadingIndicator"></app-spinner>
        </mat-expansion-panel>
      </mat-card>
  </div>
