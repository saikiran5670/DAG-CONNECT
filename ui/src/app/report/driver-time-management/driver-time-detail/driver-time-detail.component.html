<div *ngIf="driverSelected" fxLayout="row" fxLayoutAlign="flex-end" class='margin-bottom-sm'>
    <div fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="end" class='margin-right-xxlg'>
        <span class='custom-font' (click)="backToMainPageCall()">
            <span>
                <&nbsp;</span>
                    <span class='backBtnCss'>{{ translationData.lblBack || 'Back' }}</span>
        </span>
    </div>
</div>
<mat-card class='mat-elevation-z no-padding margin-bottom-xlg'>
    <mat-expansion-panel [(expanded)]="generalExpandPanel" class="full-width" fxLayoutGap="10px">
      <mat-expansion-panel-header class="full-width">
        <mat-panel-title >
          <span style='font: 500 16px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ translationData.lblGeneral || 'General' }}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div [ngClass]="{'reportTable': displayedColumns.length > 7}">
        <div style='padding: 20px; margin-bottom: 10px; background: #eee9e9;'>
          <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">
            <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
              <span>
                <span>{{ translationData.lblFrom || 'From' }}: </span>
                <span style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.fromDisplayDate }}</span>
              </span>
            </div>
            <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
              <span>
                <span>{{ translationData.lblVehicleGroup|| 'Driver Name' }}: </span>
                <span style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.selectedDriverName }}</span>
              </span>
            </div>
          </div>
          <div fxLayout="row" fxLayoutAlign="left" class="full-width" fxLayoutGap="10px">

            <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
              <span>
                <span>{{ translationData.lblTo|| 'To' }}: </span>
                <span style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.toDisplayDate }}</span>
              </span>
            </div>
            <div class="areaWidth min-width-30-per" fxLayout="column" fxLayoutAlign="left">
              <span>
                <span>{{ translationData.lblVehicle || 'Driver Id' }}: </span>
                <span style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.selectedDriverId }}</span>
              </span>
            </div>
          </div>
        </div>
        <div style='margin-bottom: 10px;' >
          <div fxLayout="row" fxLayoutAlign="space-between" class="full-width" fxLayoutGap="10px">
            
            <div class="areaWidth min-width-15-per divTile" fxLayout="column" fxLayoutAlign="left">
              <span>
                <div>{{ translationData.lblTotalDriveTime || 'Total Drive Time' }}: </div>
                <div style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.driveTime }} (hh:mm)</div>
              </span>
            </div>
              <div class="areaWidth min-width-15-per divTile" fxLayout="column" fxLayoutAlign="left">
                <span>
                  <div>{{ translationData.lblTotalWorkTime || 'Total Work Time' }}: </div>
                  <div style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.workTime }} (hh:mm)</div>
                </span>
              </div>
              <div class="areaWidth min-width-15-per divTile" fxLayout="column" fxLayoutAlign="left">
                <span>
                  <div>{{ translationData.lblTotalAvailableTime || 'Total Available Time' }}: </div>
                  <div style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.availableTime }} (hh:mm)</div>
                </span>
              </div>
              <div  class="areaWidth min-width-15-per divTile" fxLayout="column" fxLayoutAlign="left">
                <span>
                  <div>{{ translationData.lblTotalRestTime || 'Total Rest Time' }}: </div>
                  <div style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.restTime }} (hh:mm)</div>
                </span>
              </div>
              <div  class="areaWidth min-width-15-per divTile" fxLayout="column" fxLayoutAlign="left">
                <span>
                  <div>{{ translationData.lblTotalRestTime || 'Total Service Time' }}: </div>
                  <div style='font: 500 14px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ driverDetails.serviceTime }} (hh:mm)</div>
                </span>
              </div>
          </div>
        </div>
      </div>
      </mat-expansion-panel>
  </mat-card>
  <mat-card *ngIf='showField.specificdetailchart' class='mat-elevation-z no-padding margin-bottom-xlg'>
    <mat-expansion-panel [(expanded)]="chartExpandPanel" class="full-width" fxLayoutGap="10px">
      <mat-expansion-panel-header class="full-width">
        <mat-panel-title >
          <span style='font: 500 16px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ translationData.lblCharts || 'Charts' }}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div class="areaWidth min-width-60-per" fxLayout="column" fxLayoutAlign="left">
        <div class="areaWidth min-width-60-per" fxLayout="row" fxLayoutAlign="left" style="font-weight: bold;"><mat-label> {{ translationData.lblFrom || 'From'}} {{driverDetails.fromDisplayOnlyDate}} {{translationData.lblTo || 'To'}} {{driverDetails.toDisplayOnlyDate}}</mat-label></div>
        <div *ngIf='zoomMsg' class="areaWidth min-width-40-per" fxLayout="row" fxLayoutAlign="flex-end"><mat-label>Drag to zoom in</mat-label></div>     
      </div>
      <div [ngClass]="{'reportTable': displayedColumns.length > 7}">
        <div style='padding: 20px; margin-bottom: 10px;'>
          <div class="row">
            <div class="col-md-12">
              <div style="display: block">
                <canvas baseChart [datasets]="barChartData" [labels]="barChartLabels" [options]="barChartOptions"
                  [legend]="barChartLegend" [chartType]="barChartType" 
                  (chartHover)="chartHovered($event)"
                  (chartClick)="chartClicked($event)" (resetZoom)='onZoomReset()'></canvas>
                  <!-- <canvas id="chartCanvas" width="600" height="160" style="display: block; height: 160px; width: 600px;"></canvas>
                  <div style="opacity:0;" class="chartTooltip center">
                  </div> -->
              </div>
            </div>
          </div>
        </div>
      </div>
      </mat-expansion-panel>
  </mat-card>
  <mat-card class='mat-elevation-z no-padding margin-bottom-xlg'>
    <mat-expansion-panel [(expanded)]="tableExpandPanel" class="full-width" fxLayoutGap="10px">
      <mat-expansion-panel-header class="full-width">
        <mat-panel-title >
          <span style='font: 500 16px/32px Roboto, "Helvetica Neue", sans-serif;'>{{ translationData.lblAllDetails || 'All Details' }}</span>
        </mat-panel-title>
      </mat-expansion-panel-header>
      
      <div [ngClass]="{'reportTable': displayedColumns.length > 7}">

        <div fxLayout="row" fxLayoutAlign="space-between" class='margin-bottom-sm' fxLayoutGap="10px">
          <div class='areaWidth' fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="left">
            <mat-form-field appearance="outline">
                <input matInput (keyup)="applyFilter($event.target.value)" placeholder="{{ translationData.lblSearch || 'Search' }}">
                <span matPrefix><mat-icon>search</mat-icon></span>
            </mat-form-field>
          </div>
          <div class='areaWidth' fxLayout="column" fxLayoutGap="3px" fxLayoutAlign="end">
            <button mat-button [matMenuTriggerFor]="menu">
              <mat-icon>file_upload</mat-icon>{{ translationData.lblExport || 'Export' }}<mat-icon>more_vert</mat-icon>
            </button>
            <mat-menu #menu="matMenu">
              <button mat-menu-item (click)="exportAsExcelFile()">{{ translationData.lblExcel || 'Excel' }}</button>
              <button mat-menu-item (click)="exportAsPDFFile()">{{ translationData.lblPDF || 'PDF' }}</button>
            </mat-menu>
          </div>
        </div>
        <mat-table matTableExporter [dataSource]="dataSource" class="table-items"
            matSort #exporter="matTableExporter">
           
            <!-- <ng-container *ngIf="showField.startTime" matColumnDef="startTime">condition removed for pref update -->
            <ng-container matColumnDef="startTime">
              <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblDate || 'Date' }} <span style="font-weight: normal;"></span>
              </mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.startTime != '' ? row.startTime : '-' }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="driveTime">
              <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblDriveTime || 'Drive Time' }} (hh:mm)
              </mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.driveTime != '' ? row.driveTime : '-' }}</mat-cell>
            </ng-container>
            <ng-container  matColumnDef="workTime">
              <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblWorkTime || 'Work Time' }} (hh:mm)
              </mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.workTime != '' ? row.workTime : '-' }}</mat-cell>
            </ng-container>
            <ng-container  matColumnDef="serviceTime">
              <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblServiceTime || 'Service Time' }} (hh:mm)
              </mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.serviceTime != '' ? row.serviceTime : '-' }}</mat-cell>
            </ng-container>
            <ng-container  matColumnDef="restTime">
              <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblRestTime || 'Rest Time' }} (hh:mm)
              </mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.restTime != '' ? row.restTime : '-' }}</mat-cell>
            </ng-container>
            <ng-container  matColumnDef="availableTime">
              <mat-header-cell *matHeaderCellDef mat-sort-header>{{ translationData.lblAvailableTime || 'Available Time' }} (hh:mm)
              </mat-header-cell>
              <mat-cell *matCellDef="let row">{{ row.availableTime != '' ? row.availableTime : '-' }}</mat-cell>
            </ng-container>
           
            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;">
            </mat-row>
          </mat-table>
          <div class='mt-1'><mat-label>* {{ translationData.lblTableInstruction || 'values are processed with partial data'}}</mat-label></div>
          <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]" (page)="pageSizeUpdated($event)"></mat-paginator>
      </div>
      <app-spinner *ngIf="showLoadingIndicator"></app-spinner>
      </mat-expansion-panel>
  </mat-card>
